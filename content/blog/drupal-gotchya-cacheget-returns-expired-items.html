---
title: "Drupal Gotchya: Cache_get() Returns Expired Items"
date: Wed Jul 29 2009 00:00:00 GMT+1200 (New Zealand Standard Time)
drupalNodeId: 217
---

    <p><code>cache_get()</code> returns <code>$cache</code> objects even if the cached item is stale (expired).  The cached data will not be rebuilt every hour in the following example:</p>
<div class="codeblock"><code><span style="color: #000000"><span style="color: #0000BB">&lt;?php<br></span><span style="color: #FF8000">/**<br> * Builds complicated data for the monkey grip.<br> */<br></span><span style="color: #007700">function </span><span style="color: #0000BB">custom_monkey_grip_data</span><span style="color: #007700">() {<br>&nbsp; </span><span style="color: #FF8000">// Return the cached data<br>&nbsp; </span><span style="color: #0000BB">$cache </span><span style="color: #007700">= </span><span style="color: #0000BB">cache_get</span><span style="color: #007700">(</span><span style="color: #DD0000">'custom:monkey_grip'</span><span style="color: #007700">);<br>&nbsp; if (!</span><span style="color: #0000BB">$cache</span><span style="color: #007700">) {<br>&nbsp;&nbsp;&nbsp; </span><span style="color: #FF8000">// Some expensive processing to build the data.<br>&nbsp;&nbsp;&nbsp; </span><span style="color: #0000BB">$data </span><span style="color: #007700">= </span><span style="color: #0000BB">complicated_recursion_and_loops_on_lots_of_data</span><span style="color: #007700">();<br>&nbsp;&nbsp;&nbsp; <br>&nbsp;&nbsp;&nbsp; </span><span style="color: #FF8000">// Cache the data and rebuild it every hour<br>&nbsp;&nbsp;&nbsp; </span><span style="color: #0000BB">$expire </span><span style="color: #007700">= </span><span style="color: #0000BB">time</span><span style="color: #007700">() + (</span><span style="color: #0000BB">60 </span><span style="color: #007700">* </span><span style="color: #0000BB">60</span><span style="color: #007700">);<br>&nbsp;&nbsp;&nbsp; </span><span style="color: #0000BB">cache_set</span><span style="color: #007700">(</span><span style="color: #DD0000">'custom:monkey_grip'</span><span style="color: #007700">, </span><span style="color: #0000BB">$data</span><span style="color: #007700">, </span><span style="color: #DD0000">'cache'</span><span style="color: #007700">, </span><span style="color: #0000BB">$expire</span><span style="color: #007700">);<br>&nbsp; }<br>&nbsp; else {<br>&nbsp;&nbsp;&nbsp; </span><span style="color: #0000BB">$data </span><span style="color: #007700">= </span><span style="color: #0000BB">$cache</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">data</span><span style="color: #007700">;<br>&nbsp; }<br>&nbsp; return </span><span style="color: #0000BB">$data</span><span style="color: #007700">;<br>}<br></span><span style="color: #0000BB">?&gt;</span></span></code></div>
<p><a href="http://civicactions.com/blog/2009/jul/28/drupal_gotchya_cache_get_returns_expired_items" target="_blank">read more</a></p>

  
