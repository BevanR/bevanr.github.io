---
title: "Scheduled Publishing with Workbench Moderation"
date: Wed Oct 03 2012 00:00:00 GMT+1300 (New Zealand Daylight Time)
drupalNodeId: 252
---

    <p>Originally posted at <a href="http://previousnext.com.au/blog/scheduled-publishing-workbench-moderation">PreviousNext.com.au</a>.</p>
<p>Scheduler module allows content editors to specify times for content to be published and/or unpublished.  However it is not compatible with Workbench Moderation module, which allows content to have states like “<em>draft</em>” and “<em>needs review</em>” rather than just “<em>published</em>” or not.</p>
<p><a href="http://drupal.org/project/scheduler_workbench">Scheduler Workbench</a> is a new module that integrates <a href="http://drupal.org/project/workbench_moderation">Workbench Moderation</a> and <a href="http://drupal.org/project/scheduler">Scheduler</a> modules, so that content can be configured to become published or unpublished and be assigned a new moderation state at a date and time specified by the content editor.</p>
<p>PreviousNext recently built the same functionality for a client project using <a href="http://drupal.org/project/rules">Rules &amp; Rules Scheduler</a> modules.  This proved rather difficult to implement;   Workbench Moderation also allows content with a published revision to have a more recent current revision in a “<em>draft</em>” or “<em>review</em>” state while content editors are working on it, and Rules does not provide sufficient transparency to easily understand &amp; debug a number of tricky edge cases:</p>
<ul>
<li>If a content item is scheduled to be published but it already has a published revision, the current revision should become the published revision on the scheduled publishing date.</li>
<li>The content’s Workbench Moderation history should be clean and easy to audit;  There should only be one log entry per scheduled event.</li>
<li>Should the (un)publishing-dates act on revisions or nodes?  Should the date-time values be stored per revision or per node?  If revisions, do the published revision's dates preside over the current revision's dates?  Can content that is about to be (un)published still be easily exposed to content managers via the Views module and ordered by the date-time of the scheduled event?</li>
<li>Should scheduled dates be removed from the content at or after processing?  At exactly which point in the process?  How can an audit trail of executed scheduled (un)publishing be provided?</li>
<li>If both publish and unpublish scheduled events get executed on the same cron run—perhaps because an editor scheduled them very close together and/or cron has not been running for a while or is not frequent enough—does the content end up being unpublished?  Workbench Moderation calls <code>node_save()</code> content with a published revision in an "asynchronous" <code>drupal_register_shutdown_function()</code>-callback, which makes this a rather difficult edge case to handle.  Additionally;</li>
<li>Workbench Moderation's node-history table should always be consistent with with the node table;  Only nodes that have <code>node.status = 1</code> should have a row in <code>workbench_moderation_node_history</code> where <code>published = 1</code> and vice versa.  And <code>workbench_moderation_node_history</code> should only have one row where <code>current = 1</code>. And that should refer to the most recent revision.</li>
<li>Should an editor be able to scheduled already-published content to become unpublished for a specified period?  Or only the opposite?</li>
<li>If content is manually (un)published before a scheduled (un)publishing, are the respective scheduled events ignored on cron?</li>
</ul>
<p>The list goes on.</p>
<p>For a more recent project we found Scheduler Workbench module much easier to work with than a Rules-based implementation, since all of the functionality is clearly defined in unambiguous code, rather than abstracted through configuration.</p>
<p><a href="http://drupal.org/project/issues/search/scheduler_workbench?submitted=Bevan">PreviousNext contributed several patches to the module</a> to fix some bugs, handle some of the edge cases and generally get the module more stable.  All of these patches have been committed upstream already—thanks <a href="http://drupal.org/user/654480">William Hurley (whurleyf1)</a>!</p>
<p>Another <a href="http://drupal.org/node/1660192">patch for Scheduler is still in the queue</a> and is required for Scheduler Workbench to function correctly.  See <a href="http://drupal.org/node/1660252">#1660252 “<em>Publishing transitions twice through draft</em>” on drupal.org</a> for more detail.</p>
<p>Another bonus about Scheduler and Scheduler Workbench modules is that it does not require a cron-management module like <a href="http://drupal.org/project/elysia_cron">Elyisia Cron</a>, as you can call Scheduler module's own cron callback without invoking Drupal's full cron.  This is important because calling Drupal’s full cron too frequently causes performance issues, while calling it too infrequently means scheduled (un)publishing events are often “late”.</p>
<p>Scheduler Workbench can also be configured in such a way that it handles content "freshness" requirements.  PreviousNext has found that many Australian government organisations regularly audit their content.  In some cases content should even become unpublished if staff have not been marked the content as reviewed within about one year of it being published.</p>
<p>PreviousNext also implemented a Rules-based solution of content freshness for our client project.  The default review period is set per content type, but the exact expiry date can be overridden on an individual content item’s “<em>review by</em>” date field.  If a content item is not manually updated or “<em>marked as reviewed</em>”, it can be configured to become unpublished and marked as “<em>needs review</em>”, or just marked as “<em>needs review</em>” but left published.  And the default value for this option is configurable per content type.</p>
<p>Scheduler and Scheduler Workbench modules can be configured to implement a significant portion of such “freshness” requirements.</p>
  
